"""
누락된 20개 의도에 대한 학습 데이터 생성 스크립트
각 의도당 300개의 샘플을 생성하여 기존 학습 데이터와 병합
"""

import json
import random
import os

# 전체 38개 의도 (id2intent.json 기준)
ALL_INTENTS = {
    0: "가상계좌 안내",
    1: "가상계좌 예약/취소",
    2: "결제계좌 안내/변경",
    3: "결제대금 안내",
    4: "결제일 안내/변경",
    5: "교육비",
    6: "금리인하요구권 안내/신청",
    7: "기타",
    8: "긴급 배송 신청",
    9: "단기카드대출 안내/실행",
    10: "도난/분실 신청/해제",
    11: "도시가스",
    12: "매출구분 변경",
    13: "선결제/즉시출금",
    14: "쇼핑케어",
    15: "승인취소/매출취소 안내",
    16: "신용공여기간 안내",
    17: "심사 진행사항 안내",
    18: "연체대금 안내",
    19: "연체대금 즉시출금",
    20: "연회비 안내",
    21: "오토할부/오토캐쉬백 안내/신청/취소",
    22: "이벤트 안내",
    23: "이용내역 안내",
    24: "이용방법 안내",
    25: "일부결제대금이월약정 안내",
    26: "일부결제대금이월약정 해지",
    27: "입금내역 안내",
    28: "장기카드대출 안내",
    29: "전화요금",
    30: "정부지원 바우처 (등유, 임신 등)",
    31: "증명서/확인서 발급",
    32: "청구지 안내/변경",
    33: "포인트/마일리지 안내",
    34: "포인트/마일리지 전환등록",
    35: "프리미엄 바우처 안내/발급",
    36: "한도 안내",
    37: "한도상향 접수/처리"
}

# 기존 학습 데이터에 있는 18개 의도 (이미 충분한 샘플이 있음)
EXISTING_INTENTS = {
    8: "긴급 배송 신청",
    27: "입금내역 안내",
    16: "신용공여기간 안내",
    17: "심사 진행사항 안내",
    4: "결제일 안내/변경",
    36: "한도 안내",
    10: "도난/분실 신청/해제",
    20: "연회비 안내",
    33: "포인트/마일리지 안내",
    23: "이용내역 안내",
    37: "한도상향 접수/처리",
    9: "단기카드대출 안내/실행",
    28: "장기카드대출 안내",
    13: "선결제/즉시출금",
    22: "이벤트 안내",
    31: "증명서/확인서 발급",
    6: "금리인하요구권 안내/신청",
    34: "포인트/마일리지 전환등록"
}

# 누락된 20개 의도
MISSING_INTENTS = {k: v for k, v in ALL_INTENTS.items() if k not in EXISTING_INTENTS}

# 각 의도별 샘플 문장 템플릿 (다양한 표현 포함)
INTENT_TEMPLATES = {
    0: {  # 가상계좌 안내
        "name": "가상계좌 안내",
        "templates": [
            "가상계좌 번호 알려주세요",
            "가상계좌로 입금하려면 어떻게 해야 하나요",
            "제 가상계좌가 뭔가요",
            "가상계좌 정보 확인하고 싶어요",
            "카드 결제용 가상계좌 번호가 어떻게 되나요",
            "가상계좌 안내해 주세요",
            "가상계좌로 결제하려고 하는데요",
            "가상계좌 조회하고 싶습니다",
            "제 카드 가상계좌 번호 알 수 있을까요",
            "가상계좌 이용방법 알려주세요"
        ],
        "prefixes": ["", "안녕하세요, ", "저기요, ", "혹시 ", "음 ", "아 ", "그 "],
        "suffixes": ["", "요", "습니다", "ㄹ게요", "부탁드려요", "할래요", "할게요"]
    },
    1: {  # 가상계좌 예약/취소
        "name": "가상계좌 예약/취소",
        "templates": [
            "가상계좌 예약 취소하고 싶어요",
            "가상계좌 입금 예약했는데 취소해주세요",
            "가상계좌 자동이체 취소하려고요",
            "가상계좌 예약 변경하고 싶습니다",
            "가상계좌 입금 예약 가능한가요",
            "가상계좌로 예약 결제 신청하려고 하는데요",
            "가상계좌 예약 내역 확인해주세요",
            "가상계좌 예약 등록하고 싶어요",
            "가상계좌 자동 입금 설정해주세요",
            "가상계좌 예약 해지하려고요"
        ],
        "prefixes": ["", "안녕하세요, ", "저기요, ", "혹시 ", "음 ", "아 ", "그 "],
        "suffixes": ["", "요", "습니다", "ㄹ게요", "부탁드려요", "할래요"]
    },
    2: {  # 결제계좌 안내/변경
        "name": "결제계좌 안내/변경",
        "templates": [
            "결제계좌 변경하고 싶어요",
            "카드 대금 출금 계좌 바꾸려고요",
            "결제 계좌 확인해주세요",
            "자동이체 계좌 변경하고 싶습니다",
            "출금 계좌를 다른 은행으로 바꾸고 싶어요",
            "결제계좌 어떤 계좌인지 알려주세요",
            "카드값 빠져나가는 계좌 변경하려고요",
            "결제계좌 정보 조회해주세요",
            "자동이체 계좌 어디로 등록되어 있나요",
            "결제계좌 수정하고 싶어요"
        ],
        "prefixes": ["", "안녕하세요, ", "저기요, ", "혹시 ", "음 ", "아 ", "그 "],
        "suffixes": ["", "요", "습니다", "ㄹ게요", "부탁드려요", "할래요"]
    },
    3: {  # 결제대금 안내
        "name": "결제대금 안내",
        "templates": [
            "이번 달 결제 금액이 얼마인가요",
            "카드값 얼마나 나왔어요",
            "이번 달 청구 금액 알려주세요",
            "결제 예정 금액 확인하고 싶어요",
            "카드 대금이 얼마인지 알고 싶어요",
            "이번 달 카드값 조회해주세요",
            "청구서 금액 확인하려고요",
            "카드 결제 금액이 궁금해요",
            "이번 달 얼마 나왔는지 알려주세요",
            "결제대금 조회하고 싶습니다"
        ],
        "prefixes": ["", "안녕하세요, ", "저기요, ", "혹시 ", "음 ", "아 ", "그 "],
        "suffixes": ["", "요", "습니다", "ㄹ게요", "부탁드려요", "할래요"]
    },
    5: {  # 교육비
        "name": "교육비",
        "templates": [
            "교육비 납부하려고 하는데요",
            "학원비 카드로 결제할 수 있나요",
            "교육비 자동이체 설정하고 싶어요",
            "학비 카드 결제 가능한가요",
            "교육비 할부 되나요",
            "학원비 청구 내역 확인해주세요",
            "교육비 결제 방법 알려주세요",
            "학비 납부 확인하고 싶습니다",
            "교육비 영수증 발급해주세요",
            "학원비 카드로 내려고요"
        ],
        "prefixes": ["", "안녕하세요, ", "저기요, ", "혹시 ", "음 ", "아 ", "그 "],
        "suffixes": ["", "요", "습니다", "ㄹ게요", "부탁드려요", "할래요"]
    },
    7: {  # 기타
        "name": "기타",
        "templates": [
            "다른 문의사항이 있어요",
            "다른 거 물어볼게요",
            "상담사 연결해주세요",
            "사람이랑 통화하고 싶어요",
            "ARS 다시 들으려고요",
            "처음부터 다시 안내해주세요",
            "메뉴 다시 듣고 싶어요",
            "다른 서비스 문의드려요",
            "기타 문의사항입니다",
            "앞에서 설명한 것 말고 다른 거요"
        ],
        "prefixes": ["", "안녕하세요, ", "저기요, ", "혹시 ", "음 ", "아 ", "그 "],
        "suffixes": ["", "요", "습니다", "ㄹ게요", "부탁드려요", "할래요"]
    },
    11: {  # 도시가스
        "name": "도시가스",
        "templates": [
            "도시가스 요금 카드로 내려고요",
            "가스비 자동이체 신청하고 싶어요",
            "도시가스 요금 결제하려고 하는데요",
            "가스 요금 카드 납부 방법 알려주세요",
            "도시가스비 청구서 확인해주세요",
            "가스요금 할부 가능한가요",
            "도시가스 자동납부 등록하려고요",
            "가스비 이번 달 얼마나 나왔어요",
            "도시가스 결제 내역 조회해주세요",
            "가스요금 납부 확인하고 싶습니다"
        ],
        "prefixes": ["", "안녕하세요, ", "저기요, ", "혹시 ", "음 ", "아 ", "그 "],
        "suffixes": ["", "요", "습니다", "ㄹ게요", "부탁드려요", "할래요"]
    },
    12: {  # 매출구분 변경
        "name": "매출구분 변경",
        "templates": [
            "일시불을 할부로 바꾸고 싶어요",
            "할부 개월 수 변경하려고요",
            "결제 방식 변경하고 싶습니다",
            "일시불 결제건 할부로 전환해주세요",
            "할부를 일시불로 바꿀 수 있나요",
            "매출 구분 변경 가능한가요",
            "결제 건 할부 변경하려고요",
            "3개월 할부를 6개월로 바꾸고 싶어요",
            "일시불 거래를 할부로 바꿔주세요",
            "할부 기간 연장하고 싶습니다"
        ],
        "prefixes": ["", "안녕하세요, ", "저기요, ", "혹시 ", "음 ", "아 ", "그 "],
        "suffixes": ["", "요", "습니다", "ㄹ게요", "부탁드려요", "할래요"]
    },
    14: {  # 쇼핑케어
        "name": "쇼핑케어",
        "templates": [
            "쇼핑케어 서비스 알려주세요",
            "쇼핑케어 신청하고 싶어요",
            "쇼핑케어 이용방법이 궁금해요",
            "쇼핑케어로 구매 보호받을 수 있나요",
            "쇼핑케어 혜택이 뭔가요",
            "쇼핑케어 보상 신청하려고요",
            "쇼핑케어 가입되어 있나요",
            "쇼핑케어 서비스 해지하고 싶어요",
            "쇼핑케어 청구 내역 확인해주세요",
            "쇼핑케어로 환불받을 수 있나요"
        ],
        "prefixes": ["", "안녕하세요, ", "저기요, ", "혹시 ", "음 ", "아 ", "그 "],
        "suffixes": ["", "요", "습니다", "ㄹ게요", "부탁드려요", "할래요"]
    },
    15: {  # 승인취소/매출취소 안내
        "name": "승인취소/매출취소 안내",
        "templates": [
            "결제 취소하고 싶어요",
            "승인 취소 확인해주세요",
            "매출 취소 처리됐나요",
            "카드 결제 취소했는데 언제 환불되나요",
            "승인취소 내역 조회하고 싶습니다",
            "결제 취소가 안 됐어요",
            "매출취소 신청하려고요",
            "환불 처리 언제 되나요",
            "취소된 결제 확인해주세요",
            "승인취소 처리 중인 건 있나요"
        ],
        "prefixes": ["", "안녕하세요, ", "저기요, ", "혹시 ", "음 ", "아 ", "그 "],
        "suffixes": ["", "요", "습니다", "ㄹ게요", "부탁드려요", "할래요"]
    },
    18: {  # 연체대금 안내
        "name": "연체대금 안내",
        "templates": [
            "연체 금액이 얼마인가요",
            "연체된 카드값 확인하고 싶어요",
            "연체 내역 조회해주세요",
            "미납금이 얼마인지 알려주세요",
            "연체료가 얼마나 붙었나요",
            "연체 대금 안내해주세요",
            "밀린 카드값 얼마인지 알고 싶어요",
            "연체 상태 확인하려고요",
            "연체금 납부하려면 얼마 내야 하나요",
            "카드 연체 금액 조회해주세요"
        ],
        "prefixes": ["", "안녕하세요, ", "저기요, ", "혹시 ", "음 ", "아 ", "그 "],
        "suffixes": ["", "요", "습니다", "ㄹ게요", "부탁드려요", "할래요"]
    },
    19: {  # 연체대금 즉시출금
        "name": "연체대금 즉시출금",
        "templates": [
            "연체금 지금 바로 납부하고 싶어요",
            "연체 대금 즉시 결제하려고요",
            "밀린 카드값 바로 내고 싶습니다",
            "연체금 즉시 출금해주세요",
            "연체 금액 지금 납부할게요",
            "미납금 바로 결제하려고요",
            "연체대금 즉시 납부 가능한가요",
            "밀린 금액 지금 빼가세요",
            "연체금 오늘 바로 내려고요",
            "연체 대금 즉시 처리해주세요"
        ],
        "prefixes": ["", "안녕하세요, ", "저기요, ", "혹시 ", "음 ", "아 ", "그 "],
        "suffixes": ["", "요", "습니다", "ㄹ게요", "부탁드려요", "할래요"]
    },
    21: {  # 오토할부/오토캐쉬백 안내/신청/취소
        "name": "오토할부/오토캐쉬백 안내/신청/취소",
        "templates": [
            "오토할부 신청하고 싶어요",
            "자동 할부 서비스 알려주세요",
            "오토캐쉬백 어떻게 받나요",
            "자동할부 해지하려고요",
            "오토할부 설정 변경하고 싶습니다",
            "오토캐쉬백 적용 안내해주세요",
            "자동 할부 취소하려고요",
            "오토할부 조건이 어떻게 되나요",
            "오토캐쉬백 신청하고 싶어요",
            "자동할부 등록되어 있나요"
        ],
        "prefixes": ["", "안녕하세요, ", "저기요, ", "혹시 ", "음 ", "아 ", "그 "],
        "suffixes": ["", "요", "습니다", "ㄹ게요", "부탁드려요", "할래요"]
    },
    24: {  # 이용방법 안내 (★ 중요: overseas_payment E2E 테스트용)
        "name": "이용방법 안내",
        "templates": [
            "해외에서 카드 사용하려면 어떻게 해야 하나요",
            "해외 결제 방법 알려주세요",
            "해외 결제 가능하게 해주세요",
            "해외에서 카드 쓰는 방법이요",
            "해외 이용 설정해주세요",
            "해외 결제 차단 풀어주세요",
            "해외에서 카드가 안 되는데요",
            "해외 결제 활성화해주세요",
            "카드 해외 이용 방법 알려주세요",
            "해외에서 결제하려고 하는데 어떻게 하나요",
            "해외 결제 서비스 이용방법이요",
            "카드 이용 방법 안내해주세요",
            "신용카드 사용법 알려주세요",
            "카드 결제하는 방법이 궁금해요",
            "온라인 결제 방법 알려주세요",
            "앱으로 결제하는 방법이요",
            "모바일 결제 이용방법 알려주세요",
            "비접촉 결제 방법이 뭔가요",
            "페이 서비스 연결 방법 알려주세요",
            "카드 등록하는 방법이요"
        ],
        "prefixes": ["", "안녕하세요, ", "저기요, ", "혹시 ", "음 ", "아 ", "그 "],
        "suffixes": ["", "요", "습니다", "ㄹ게요", "부탁드려요", "할래요"]
    },
    25: {  # 일부결제대금이월약정 안내 (★ 중요: installment E2E 테스트용)
        "name": "일부결제대금이월약정 안내",
        "templates": [
            "리볼빙 서비스가 뭔가요",
            "일부결제대금이월약정 알려주세요",
            "리볼빙 신청하고 싶어요",
            "결제금액 일부만 내고 나머지 이월하려고요",
            "리볼빙 이자율이 어떻게 되나요",
            "일부결제대금이월 서비스 설명해주세요",
            "리볼빙 수수료가 궁금해요",
            "일부만 결제하고 나머지 다음 달로 넘기려고요",
            "리볼빙 가입되어 있나요",
            "최소결제금액만 내고 싶어요",
            "이번 달 카드값 일부만 내려고요",
            "리볼빙 결제 방식 알려주세요",
            "일부결제대금이월약정 신청하려고요",
            "카드값 나눠서 내는 방법이요",
            "리볼빙 조건이 어떻게 되나요",
            "결제 금액 이월하고 싶습니다",
            "최소결제금액이 얼마인가요",
            "리볼빙 한도 확인해주세요",
            "일부결제 서비스 신청하고 싶어요",
            "결제금 이월하는 방법 알려주세요"
        ],
        "prefixes": ["", "안녕하세요, ", "저기요, ", "혹시 ", "음 ", "아 ", "그 "],
        "suffixes": ["", "요", "습니다", "ㄹ게요", "부탁드려요", "할래요"]
    },
    26: {  # 일부결제대금이월약정 해지
        "name": "일부결제대금이월약정 해지",
        "templates": [
            "리볼빙 해지하고 싶어요",
            "일부결제대금이월약정 취소하려고요",
            "리볼빙 서비스 해지해주세요",
            "이월약정 해지하고 싶습니다",
            "리볼빙 탈퇴하려고요",
            "일부결제 서비스 해지 신청이요",
            "리볼빙 그만 쓰고 싶어요",
            "이월약정 취소 방법 알려주세요",
            "리볼빙 해지하면 잔액은 어떻게 되나요",
            "일부결제대금이월약정 해지 신청합니다"
        ],
        "prefixes": ["", "안녕하세요, ", "저기요, ", "혹시 ", "음 ", "아 ", "그 "],
        "suffixes": ["", "요", "습니다", "ㄹ게요", "부탁드려요", "할래요"]
    },
    29: {  # 전화요금
        "name": "전화요금",
        "templates": [
            "전화요금 카드로 내려고요",
            "통신비 자동이체 신청하고 싶어요",
            "핸드폰 요금 결제하려고 하는데요",
            "전화비 카드 납부 방법 알려주세요",
            "통신요금 청구서 확인해주세요",
            "핸드폰비 할부 가능한가요",
            "전화요금 자동납부 등록하려고요",
            "통신비 이번 달 얼마나 나왔어요",
            "전화비 결제 내역 조회해주세요",
            "핸드폰 요금 납부 확인하고 싶습니다"
        ],
        "prefixes": ["", "안녕하세요, ", "저기요, ", "혹시 ", "음 ", "아 ", "그 "],
        "suffixes": ["", "요", "습니다", "ㄹ게요", "부탁드려요", "할래요"]
    },
    30: {  # 정부지원 바우처 (등유, 임신 등)
        "name": "정부지원 바우처 (등유, 임신 등)",
        "templates": [
            "정부지원 바우처 신청하려고요",
            "임신 바우처 사용 방법 알려주세요",
            "등유 바우처 어떻게 쓰나요",
            "국민행복카드 등록하고 싶어요",
            "정부 지원금 카드로 받을 수 있나요",
            "바우처 잔액 확인해주세요",
            "임신출산 바우처 신청하려고요",
            "아이돌봄 바우처 사용처가 어디인가요",
            "정부지원금 카드 연결하고 싶어요",
            "에너지 바우처 신청 방법이요"
        ],
        "prefixes": ["", "안녕하세요, ", "저기요, ", "혹시 ", "음 ", "아 ", "그 "],
        "suffixes": ["", "요", "습니다", "ㄹ게요", "부탁드려요", "할래요"]
    },
    32: {  # 청구지 안내/변경
        "name": "청구지 안내/변경",
        "templates": [
            "청구서 주소 변경하고 싶어요",
            "우편 청구서 받는 주소 바꾸려고요",
            "청구지 변경해주세요",
            "카드 명세서 주소 변경하려고요",
            "청구서 받는 곳 확인해주세요",
            "이메일 청구서로 변경하고 싶어요",
            "청구지 어디로 등록되어 있나요",
            "명세서 주소 수정하려고요",
            "청구서 안 와서요 주소 확인해주세요",
            "청구지 정보 변경하고 싶습니다"
        ],
        "prefixes": ["", "안녕하세요, ", "저기요, ", "혹시 ", "음 ", "아 ", "그 "],
        "suffixes": ["", "요", "습니다", "ㄹ게요", "부탁드려요", "할래요"]
    },
    35: {  # 프리미엄 바우처 안내/발급
        "name": "프리미엄 바우처 안내/발급",
        "templates": [
            "프리미엄 바우처 발급받고 싶어요",
            "VIP 바우처 사용 방법 알려주세요",
            "프리미엄 서비스 바우처가 뭔가요",
            "바우처 혜택 안내해주세요",
            "프리미엄 바우처 신청하려고요",
            "특별 바우처 발급 조건이 뭔가요",
            "프리미엄 바우처 잔여 확인해주세요",
            "VIP 바우처 어디서 쓸 수 있나요",
            "프리미엄 혜택 바우처 받고 싶어요",
            "바우처 발급 신청합니다"
        ],
        "prefixes": ["", "안녕하세요, ", "저기요, ", "혹시 ", "음 ", "아 ", "그 "],
        "suffixes": ["", "요", "습니다", "ㄹ게요", "부탁드려요", "할래요"]
    }
}


def generate_samples_for_intent(intent_id, target_count=300):
    """
    특정 의도에 대한 학습 데이터 생성
    """
    if intent_id not in INTENT_TEMPLATES:
        print(f"[WARNING] 의도 ID {intent_id}에 대한 템플릿이 없습니다.")
        return []

    template_info = INTENT_TEMPLATES[intent_id]
    intent_name = template_info["name"]
    templates = template_info["templates"]
    prefixes = template_info["prefixes"]
    suffixes = template_info["suffixes"]

    samples = []
    generated_texts = set()

    # 모든 조합 생성
    for template in templates:
        for prefix in prefixes:
            for suffix in suffixes:
                text = prefix + template
                if suffix and not text.endswith(('요', '니다', '게요', '려요', '래요')):
                    text += suffix

                if text not in generated_texts:
                    generated_texts.add(text)
                    samples.append({
                        "text": text,
                        "intent": intent_name,
                        "intent_id": intent_id
                    })

    # 변형 추가 (목표 개수까지)
    variations = [
        ("요", "습니다"),
        ("습니다", "요"),
        ("해주세요", "해 주세요"),
        ("알려주세요", "알려 주세요"),
        ("싶어요", "싶습니다"),
        ("하려고요", "하고 싶어요"),
        ("하는데요", "하려고 하는데요"),
        ("", "저기 "),
        ("", "아 "),
        ("", "음 "),
        ("가능한가요", "되나요"),
        ("되나요", "가능한가요"),
    ]

    # 샘플이 비어있으면 더 이상 진행 불가
    if not samples:
        print(f"[WARNING] 의도 ID {intent_id}에 대한 초기 샘플이 없습니다.")
        return []

    # 초기 샘플 수 기록 (변형의 기반으로 사용)
    initial_sample_count = len(samples)
    max_iterations = target_count * 10  # 무한 루프 방지
    iteration = 0

    while len(samples) < target_count and iteration < max_iterations:
        iteration += 1
        base_sample = random.choice(samples[:initial_sample_count])  # 원본 기반만 사용
        text = base_sample["text"]

        # 랜덤 변형 적용
        old, new = random.choice(variations)
        if old in text:
            new_text = text.replace(old, new, 1)
        else:
            new_text = random.choice(prefixes) + text

        if new_text not in generated_texts:
            generated_texts.add(new_text)
            samples.append({
                "text": new_text,
                "intent": intent_name,
                "intent_id": intent_id
            })

    return samples[:target_count]


def main():
    """
    누락된 20개 의도에 대한 학습 데이터 생성 및 기존 데이터와 병합
    """
    print("=" * 80)
    print("누락된 의도 학습 데이터 생성")
    print("=" * 80)

    # 기존 학습 데이터 로드
    existing_data_path = "data/augmented_intent_training_data_merged.json"
    if os.path.exists(existing_data_path):
        with open(existing_data_path, 'r', encoding='utf-8') as f:
            existing_data = json.load(f)
        print(f"[OK] 기존 학습 데이터 로드: {len(existing_data):,}개")
    else:
        existing_data = []
        print("[WARNING] 기존 학습 데이터가 없습니다.")

    # 기존 의도별 개수 확인
    existing_intent_counts = {}
    for item in existing_data:
        intent = item.get("intent", "unknown")
        existing_intent_counts[intent] = existing_intent_counts.get(intent, 0) + 1

    print(f"\n[기존 데이터 의도 분포]")
    for intent, count in sorted(existing_intent_counts.items(), key=lambda x: -x[1]):
        print(f"  - {intent}: {count}개")

    # 누락된 의도 확인
    print(f"\n[누락된 의도 목록] (총 {len(MISSING_INTENTS)}개)")
    for intent_id, intent_name in sorted(MISSING_INTENTS.items()):
        count = existing_intent_counts.get(intent_name, 0)
        print(f"  - {intent_id}: {intent_name} ({count}개)")

    # 새 데이터 생성
    new_samples = []
    for intent_id in MISSING_INTENTS.keys():
        if intent_id in INTENT_TEMPLATES:
            samples = generate_samples_for_intent(intent_id, target_count=300)
            new_samples.extend(samples)
            print(f"[생성] {INTENT_TEMPLATES[intent_id]['name']}: {len(samples)}개")
        else:
            print(f"[SKIP] 의도 ID {intent_id}에 대한 템플릿이 없습니다.")

    print(f"\n[OK] 새로 생성된 샘플: {len(new_samples):,}개")

    # 병합
    merged_data = existing_data + new_samples

    # 중복 제거
    seen_texts = set()
    unique_data = []
    for item in merged_data:
        if item["text"] not in seen_texts:
            seen_texts.add(item["text"])
            unique_data.append(item)

    print(f"[OK] 중복 제거 후: {len(unique_data):,}개")

    # 최종 의도 분포 확인
    final_intent_counts = {}
    for item in unique_data:
        intent = item.get("intent", "unknown")
        final_intent_counts[intent] = final_intent_counts.get(intent, 0) + 1

    print(f"\n[최종 데이터 의도 분포] (총 {len(final_intent_counts)}개 의도)")
    for intent, count in sorted(final_intent_counts.items(), key=lambda x: -x[1]):
        print(f"  - {intent}: {count}개")

    # 저장
    output_path = "data/augmented_intent_training_data_complete.json"
    with open(output_path, 'w', encoding='utf-8') as f:
        json.dump(unique_data, f, ensure_ascii=False, indent=2)

    print(f"\n[OK] 저장 완료: {output_path}")
    print(f"[OK] 총 {len(unique_data):,}개 샘플, {len(final_intent_counts)}개 의도")

    # 검증: E2E 테스트에 필요한 의도가 있는지 확인
    required_intents = ["이용방법 안내", "일부결제대금이월약정 안내", "결제대금 안내", "결제계좌 안내/변경"]
    print(f"\n[E2E 테스트 필수 의도 검증]")
    for intent in required_intents:
        count = final_intent_counts.get(intent, 0)
        status = "OK" if count > 0 else "MISSING"
        print(f"  [{status}] {intent}: {count}개")


if __name__ == "__main__":
    main()
