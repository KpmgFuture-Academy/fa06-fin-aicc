# 도메인별 슬롯 시스템 구현 완료

## 개요
ChromaDB에 저장된 38개 카테고리 문서의 "6. 고객정보 필요 여부 및 요청 항목" 섹션을 기반으로 카테고리별 필요 정보를 슬롯으로 정의합니다.

---

## 1. 슬롯 정의

| 슬롯 | 출처 | 설명 |
|------|------|------|
| 문의유형 | triage_agent → 도메인 매핑 | 8개 도메인 (PAY_BILL, LIMIT_AUTH 등) |
| 상세요청 | triage_agent → 카테고리 | 38개 카테고리 (분실/도난 신고, 한도상향 등) |
| 도메인별 슬롯 | slot_definitions.json | 카테고리별 필요 정보 |

---

## 2. 판단 에이전트 (triage_agent)

`triage_agent.py`에서 수행하는 역할:

```
사용자 입력
    ↓
[triage_agent]
    ├─ intent_classification_tool: 38개 카테고리 분류
    ├─ rag_search_tool: ChromaDB 문서 검색
    └─ 최종 판단 (4가지 중 하나):
        - SIMPLE_ANSWER: 단순 응답 (인사 등)
        - AUTO_ANSWER: RAG 기반 자동 응답
        - NEED_MORE_INFO: 추가 정보 필요
        - HUMAN_REQUIRED: 상담사 연결 필요
```

---

## 3. 흐름별 동작

### Case A: 문의 내용이 있는 상담사 연결

```
사용자: "카드 분실했어요"
    ↓
[triage_agent]
    ├─ 의도 분류: SEC_CARD / 분실·도난 신고
    ├─ 판단: HUMAN_REQUIRED (긴급 상황)
    └─ context_intent: "분실/도난 신고"
    ↓
[answer_agent] → 상담사 연결 안내
    ↓
[waiting_agent]
    ├─ _domain_name: "분실/보안" (자동 - 도메인)
    ├─ _category: "분실/도난 신고" (자동 - 카테고리)
    └─ 도메인별 슬롯 질문 시작
        → "카드 뒤 4자리를 알려주시겠어요?"
```

### Case B: 맥락 없이 상담사 연결 요청

```
사용자: "상담사 연결해주세요"
    ↓
[triage_agent]
    ├─ 의도 분류: 불명확 (신뢰도 낮음)
    ├─ 판단: HUMAN_REQUIRED
    └─ context_intent: null 또는 "기타"
    ↓
[answer_agent] → 상담사 연결 안내
    ↓
[waiting_agent]
    ├─ _domain_name: "기타" (미확정)
    ├─ _category: "기타 문의" (미확정)
    └─ 문의 상세 내용 질문:
        → "문의하신 내용을 좀 더 자세히 말씀해 주시겠어요?"
```

---

## 4. 도메인별 슬롯 예시

### 4-1. SEC_CARD (분실/보안) - 4개 카테고리

| 카테고리 | 필수 슬롯 | 근거 |
|----------|----------|------|
| 분실/도난 신고 | 카드 뒤 4자리, 분실 일시 | 카드 정지 처리에 필요 |
| 카드 정지/해제 | 카드 뒤 4자리, 요청 유형(정지/해제) | 본인 확인 및 처리 유형 |
| 비밀번호 관련 | 카드 뒤 4자리 | 본인 확인 |
| 부정사용 신고 | 카드 뒤 4자리, 부정사용 일시, 부정사용 금액 | 조사에 필요한 정보 |

### 4-2. LIMIT_AUTH (한도/승인) - 5개 카테고리

| 카테고리 | 필수 슬롯 | 근거 |
|----------|----------|------|
| 한도 안내 | 카드 종류 | 카드별 한도 상이 |
| 한도상향 접수/처리 | 카드 종류, 희망 한도 | 심사에 필요 |
| 승인취소/매출취소 | 거래 일시, 거래 금액 | 거래 특정에 필요 |
| 심사 진행사항 | (선택: 접수 번호, 접수 일시) | 건 조회에 참고 |
| 신용공여기간 안내 | 카드 종류 | 카드별 상이 |

### 4-3. PAY_BILL (결제/청구) - 11개 카테고리

| 카테고리 | 필수 슬롯 | 근거 |
|----------|----------|------|
| 결제대금 안내 | (선택: 결제월) | 월별 조회 |
| 결제일 안내/변경 | (선택: 희망 결제일) | 변경 처리에 필요 |
| 결제계좌 안내/변경 | (선택: 변경할 은행, 계좌번호) | 계좌 변경 처리 |
| 이용내역 안내 | (선택: 조회 기간) | 기간별 조회 |
| 가상계좌 안내 | - | 단순 안내, 슬롯 불필요 |
| 매출구분 변경 | 거래 일시, 변경 유형 | 변경 대상 특정 |

### 4-4. DELINQ (연체/수납) - 4개 카테고리

| 카테고리 | 필수 슬롯 | 근거 |
|----------|----------|------|
| 연체대금 안내 | - | 단순 안내, 슬롯 불필요 |
| 연체대금 즉시출금 | 출금 계좌, 출금 금액 | 출금 처리에 필요 |
| 선결제/즉시출금 | 결제 금액 | 처리에 필요 |
| 일부결제대금이월약정 | 희망 결제 비율 | 약정 설정에 필요 |

### 4-5. LOAN (대출/현금서비스) - 4개 카테고리

| 카테고리 | 필수 슬롯 | 근거 |
|----------|----------|------|
| 대출 한도/금리 안내 | (선택: 희망 대출 금액) | 한도 조회에 참고 |
| 대출 신청 | 희망 금액, 상환 기간 | 신청 처리에 필요 |
| 대출 상환 | 상환 금액, 상환 방식 | 상환 처리에 필요 |
| 카드론/현금서비스 | (선택: 희망 금액) | 이용에 참고 |

### 4-6. BENEFIT (혜택/포인트) - 4개 카테고리

| 카테고리 | 필수 슬롯 | 근거 |
|----------|----------|------|
| 포인트 조회/사용 | (선택: 사용처) | 사용 처리에 필요 |
| 할인 혜택 안내 | (선택: 카드 종류) | 카드별 혜택 상이 |
| 제휴 서비스 | (선택: 제휴사명) | 제휴사별 안내 |
| 연회비 안내/환불 | 카드 종류 | 카드별 연회비 상이 |

### 4-7. UTILITY (이용/부가서비스) - 3개 카테고리

| 카테고리 | 필수 슬롯 | 근거 |
|----------|----------|------|
| 앱/홈페이지 이용 | (선택: 문의 유형) | 문의 특정 |
| 명세서 발급 | 발급 기간 | 발급 처리에 필요 |
| 카드 재발급/배송 | 재발급 사유 | 재발급 처리에 필요 |

### 4-8. DOC_TAX (증빙/세금) - 3개 카테고리

| 카테고리 | 필수 슬롯 | 근거 |
|----------|----------|------|
| 소득공제 자료 | 조회 연도 | 연도별 자료 |
| 이용확인서 발급 | 발급 기간 | 기간별 발급 |
| 세금계산서 | 발급 기간, 사업자번호 | 발급 처리에 필요 |

---

## 5. 구현된 파일 구조

### slot_definitions.json
- 경로: `ai_engine/config/slot_definitions.json`
- 내용: 8개 도메인, 38개 카테고리별 필수/선택 슬롯 정의

### slot_metadata.json
- 경로: `ai_engine/config/slot_metadata.json`
- 내용: 45개 슬롯의 라벨, 질문, 검증 규칙

### slot_loader.py
- 경로: `ai_engine/graph/utils/slot_loader.py`
- 내용: SlotLoader 싱글톤 클래스

---

## 6. UI 표시 (상담원 대시보드)

```
┌─────────────────────────────────────┐
│  문의유형: 분실/보안                  │  ← 도메인
│  상세요청: 분실/도난 신고              │  ← 카테고리
│  ─────────────────────────────────  │
│  카드 뒤 4자리: 1234                 │  ← 동적 슬롯
│  분실 일시: 2024-12-08              │
└─────────────────────────────────────┘
```

---

## 7. 구현 작업 목록

| 순서 | 작업 | 파일 | 상태 |
|------|------|------|------|
| 1 | slot_definitions.json 생성 | `ai_engine/config/slot_definitions.json` | ✅ 완료 |
| 2 | slot_metadata.json 생성 | `ai_engine/config/slot_metadata.json` | ✅ 완료 |
| 3 | slot_loader.py 생성 | `ai_engine/graph/utils/slot_loader.py` | ✅ 완료 |
| 4 | waiting_agent.py 수정 | `ai_engine/graph/nodes/waiting_agent.py` | ✅ 완료 |
| 5 | UI 동적 슬롯 표시 | `agent-dashboard/src/pages/Dashboard.tsx` | ✅ 완료 |

---

## 8. 주요 변경 사항

### 고객 이름(customer_name) 슬롯 제거
- 기존: 모든 카테고리에서 고객 이름 필수 수집
- 변경: 고객 이름 수집 제거, 카테고리별 필요 정보만 수집

### 동적 슬롯 시스템
- `context_intent`(triage_agent에서 분류한 카테고리)를 기반으로 필요한 슬롯 자동 결정
- 필수 슬롯 수집 완료 시 `info_collection_complete = True` 설정

---

## 작성일
2024-12-09

## 완료일
2024-12-09
