# 🎧 상담원 대시보드 사용 가이드

## 📖 개요

상담원이 실시간으로 고객 이관 요청을 받아 처리할 수 있는 전용 대시보드입니다.

---

## ✨ 주요 기능

### 1. **실시간 이관 요청 수신** 🔔
- WebSocket 기반 실시간 푸시 알림
- 새로운 이관 요청이 들어오면 자동으로 목록에 추가
- 알림음 재생 (브라우저 허용 시)

### 2. **이관 요청 목록 관리** 📋
- 전체 / 대기 / 진행 / 완료 상태 통계 표시
- 세션별 이관 요청 카드 표시
- 고객 감정 상태 시각화 (😊😐😟🚨)

### 3. **상세 정보 확인** 📊
- 고객 감정 분석 결과
- 대화 요약
- 핵심 키워드 추출
- 추천 KMS 문서 (관련도 점수 포함)
- 세션 정보 (ID, 접수 시간)

### 4. **상태 관리** ⚡
- **대기 중** → **처리 중** → **완료** 단계별 관리
- 버튼 클릭으로 간편한 상태 변경
- 처리 중인 건은 목록에서 강조 표시

---

## 🚀 사용 방법

### 1단계: 대시보드 접속

```
http://localhost:5173/consultant
```

또는 채팅 페이지 상단 **"🎧 상담원 대시보드"** 버튼 클릭

---

### 2단계: 실시간 모니터링

대시보드는 자동으로 WebSocket에 연결되어 실시간으로 이관 요청을 수신합니다.

#### 화면 구성:
```
┌─────────────────────────────────────────────────────────┐
│  🎧 상담원 대시보드                                        │
│  [전체: 10] [대기: 3] [진행: 2] [완료: 5]                    │
├─────────────────┬───────────────────────────────────────┤
│  이관 요청 목록    │  상세 정보                              │
│                 │                                       │
│  ┌──────────┐  │  📊 고객 감정 상태                       │
│  │ 세션 1234 │  │  😊 긍정적                              │
│  │ 😊 긍정적  │  │                                       │
│  │ 14:30     │  │  📝 대화 요약                           │
│  └──────────┘  │  고객이 카드론에 대해 문의...              │
│                 │                                       │
│  ┌──────────┐  │  🔑 핵심 키워드                         │
│  │ 세션 5678 │  │  [카드론] [금리] [대출]                  │
│  │ 😐 중립적  │  │                                       │
│  │ 14:25     │  │  📚 추천 KMS 문서                       │
│  └──────────┘  │  • 카드론 상품 안내 (95%)                │
└─────────────────┴───────────────────────────────────────┘
```

---

### 3단계: 이관 요청 처리

#### 옵션 1: 목록에서 바로 시작
1. 좌측 목록에서 **"시작하기"** 버튼 클릭
2. 자동으로 **"처리 중"** 상태로 변경
3. 우측에 상세 정보 표시

#### 옵션 2: 상세보기 후 시작
1. 목록에서 이관 요청 카드 클릭
2. 우측에서 상세 정보 확인
3. **"▶ 상담 시작"** 버튼 클릭
4. 상태가 **"처리 중"**으로 변경

---

### 4단계: 상담 완료 처리

상담을 완료했다면:
1. 우측 상단 **"✓ 완료 처리"** 버튼 클릭
2. 상태가 **"완료"**로 변경
3. 목록에서 완료 건수 자동 업데이트

---

## 🎨 UI 요소 설명

### 고객 감정 상태 표시

| 이모지 | 감정 상태 | 설명 |
|--------|----------|------|
| 😊 | 긍정적 (POSITIVE) | 고객이 만족하고 있음 |
| 😐 | 중립적 (NEUTRAL) | 특별한 감정 표현 없음 |
| 😟 | 부정적 (NEGATIVE) | 불만이나 불편함 표시 |
| 🚨 | 긴급 (URGENT) | 즉시 처리 필요 |

### 상태 배지 색상

| 색상 | 상태 | 의미 |
|------|------|------|
| 🟠 주황 | 대기 중 | 아직 처리되지 않음 |
| 🔵 파랑 | 처리 중 | 상담원이 처리 중 |
| 🟢 초록 | 완료 | 처리 완료됨 |

---

## 🔧 기술적 세부사항

### WebSocket 연결

대시보드는 다음 URL로 WebSocket에 연결됩니다:

```
ws://localhost:8000/api/v1/chat/ws/consultant_dashboard
```

### 메시지 형식

#### 수신: 이관 리포트
```json
{
  "type": "handover_report",
  "session_id": "sess_1234567890",
  "data": {
    "status": "success",
    "customer_sentiment": "POSITIVE",
    "summary": "고객이 카드론 상품에 대해 문의하고 있습니다...",
    "extracted_keywords": ["카드론", "금리", "대출"],
    "kms_recommendations": [
      {
        "title": "카드론 상품 안내",
        "url": "https://kms.example.com/cardloan",
        "relevance_score": 0.95
      }
    ]
  }
}
```

### 재연결 메커니즘

- WebSocket 연결이 끊어지면 **5초 후 자동 재연결**
- 연결 중에는 상태가 "연결 중..."으로 표시
- 재연결 시 기존 목록 유지

---

## 🚨 문제 해결

### 1. 대시보드가 로드되지 않아요

**원인**: 프론트엔드가 실행되지 않았거나 URL이 잘못됨

**해결**:
```bash
cd frontend
npm run dev
```

그리고 `http://localhost:5173/consultant` 접속

---

### 2. 이관 요청이 수신되지 않아요

**원인**: WebSocket 연결이 안 됨

**확인 사항**:
1. 백엔드 서버가 실행 중인가요?
   ```bash
   python -m uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
   ```

2. 브라우저 콘솔(F12)에서 WebSocket 연결 상태 확인:
   ```
   ✅ 상담원 대시보드 WebSocket 연결 성공
   ```

3. 연결 오류가 보인다면:
   - 백엔드 로그 확인
   - 방화벽 설정 확인
   - 포트 8000이 열려있는지 확인

---

### 3. 알림음이 들리지 않아요

**원인**: 브라우저 자동 재생 차단

**해결**: 
1. 브라우저 주소창 왼쪽 🔒 아이콘 클릭
2. "사이트 설정" 클릭
3. "소리" 항목을 "허용"으로 변경
4. 페이지 새로고침

---

## 📊 테스트 시나리오

### 시나리오 1: 기본 플로우

1. 대시보드 접속: `http://localhost:5173/consultant`
2. 다른 창에서 채팅 시작: `http://localhost:5173`
3. 채팅창에서 "상담원 연결해주세요" 입력
4. 대시보드에 자동으로 이관 요청 표시 확인
5. "시작하기" 버튼으로 처리 시작
6. 상세 정보 확인
7. "완료 처리" 버튼으로 완료

### 시나리오 2: 다중 이관 요청

1. 여러 개의 채팅창(시크릿 모드)에서 동시에 이관 요청
2. 대시보드에 모든 요청이 실시간으로 쌓이는지 확인
3. 각 요청별로 상태 관리
4. 통계 숫자가 정확한지 확인

---

## 🎯 다음 개선 사항 (향후 계획)

- [ ] 실시간 채팅 연결 (상담원 ↔ 고객)
- [ ] 메모 기능 추가
- [ ] 이관 요청 필터링 (감정별, 시간별)
- [ ] 검색 기능
- [ ] 상담 통계 대시보드
- [ ] 알림 설정 (소리, 데스크톱 알림)
- [ ] 다크 모드 지원

---

## 💡 팁

1. **여러 모니터 환경**: 한 화면에 대시보드, 다른 화면에 채팅창을 띄워 효율적으로 작업할 수 있습니다.

2. **키보드 단축키** (향후 추가 예정):
   - `Space`: 상담 시작
   - `Enter`: 완료 처리
   - `↑/↓`: 목록 이동

3. **브라우저 알림**: 브라우저 알림 권한을 허용하면 탭이 백그라운드에 있어도 새 이관 요청을 알 수 있습니다.

---

## 📞 문의

문제가 지속되면 시스템 관리자에게 문의하거나 로그를 확인하세요:
- 프론트엔드 로그: 브라우저 콘솔 (F12)
- 백엔드 로그: 터미널에서 uvicorn 실행 화면

